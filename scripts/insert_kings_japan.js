/**
 * ì¼ë³¸(æ—¥æœ¬) ì²œí™© ê³„ë³´ ì‚½ì… ìŠ¤í¬ë¦½íŠ¸
 * - í—¤ì´ì•ˆ ì‹œëŒ€ (781â€“1185)
 * - ê°€ë§ˆì¿ ë¼~ë¬´ë¡œë§ˆì¹˜~ì „êµ­ (1185â€“1573)
 * - ì—ë„ ì‹œëŒ€ (1603â€“1867)
 * - ê·¼í˜„ëŒ€ ë©”ì´ì§€ ì´í›„ (1867â€“í˜„ì¬)
 * ì‹¤í–‰: node scripts/insert_kings_japan.js
 */

const { MongoClient, ObjectId } = require('mongodb');

const MONGO_URI = process.env.MONGO_URI || 'mongodb://localhost:27017';
const DB_NAME = 'realhistory';

const COUNTRY_ID = new ObjectId('68dc7f9ade5169a850293fc2'); // ì¼ë³¸(æ—¥æœ¬)

const NEW_KINGS = [
    // â”€â”€ í—¤ì´ì•ˆ ì‹œëŒ€ (794â€“1185) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    { name: '50ëŒ€ ê°„ë¬´ ì²œí™©(æ¡“æ­¦)', start: 781,  end: 806,  summary: 'í—¤ì´ì•ˆì¿„ ì²œë„(794). ìŠ¤ìŠ¤ë¡œ ë°±ì œ ë¬´ë ¹ì™•ì˜ í›„ì†ì„ì„ ê³µí‘œí•œ ì²œí™©.' },
    { name: '52ëŒ€ ì‚¬ê°€ ì²œí™©(åµ¯å³¨)', start: 809,  end: 823,  summary: 'ìœ¨ë ¹ ì²´ì œ ì •ë¹„ ë° ë¬¸ì¹˜ì£¼ì˜ í™•ë¦½. êµ¬ì¹´ì´(å¼˜æ³•å¤§å¸«)ë¥¼ í›„ì›í•˜ì—¬ ë°€êµ ë¬¸í™” ë¶€í¥.' },
    { name: '56ëŒ€ ì„¸ì´ì™€ ì²œí™©(æ·¸å’Œ)', start: 858, end: 876,  summary: 'ì„¸ì´ì™€ ê²ì§€(æºæ°) ë¬´ì‚¬ ê°€ë¬¸ì˜ ì‹œì¡°. ì´í›„ ë¯¸ë‚˜ëª¨í†  ì”¨ì˜ ë¿Œë¦¬ê°€ ë¨.' },
    { name: '60ëŒ€ ë‹¤ì´ê³  ì²œí™©(é†é†)', start: 897, end: 930,  summary: '\'ì—”ê¸°ì˜ ì¹˜\'ë¼ ë¶ˆë¦¬ëŠ” ì „ì„±ê¸°. ã€Šê³ í‚¨ì™€ì¹´ìŠˆã€‹ í¸ì°¬ ë“± êµ­í’ ë¬¸í™”ì˜ ì ˆì •ê¸°.' },
    { name: '66ëŒ€ ì´ì¹˜ì¡° ì²œí™©(ä¸€æ¢)', start: 986, end: 1011, summary: 'ã€Šê²ì§€ ì´ì•¼ê¸°ã€‹Â·ã€Šë² ê°œ ì±…ã€‹ ë“± ì—¬ë¥˜ ë¬¸í•™ì˜ í™©ê¸ˆê¸°. ëŒ€ë¥™ ê³ ë ¤ì™€ì˜ êµë¥˜ê°€ í™œë°œí–ˆë˜ ì‹œê¸°.' },
    { name: '71ëŒ€ ê³ ì‚°ì¡° ì²œí™©(å¾Œä¸‰æ¢)', start: 1068, end: 1072, summary: 'í›„ì§€ì™€ë¼ì”¨ì˜ ì„­ì • ì •ì¹˜ë¥¼ íƒ€íŒŒí•˜ê³  ì¹œì •ì„ ì‹¤ì‹œ. ê¸°ë¡ ì¥ì› ì •ë¦¬ë ¹ ë°œí¬.' },
    { name: '81ëŒ€ ì•ˆí† ì¿  ì²œí™©(å®‰å¾·)', start: 1180, end: 1185, summary: '1185ë…„ ë‹¨ë…¸ìš°ë¼ í•´ì „ì—ì„œ ë‹¤ì´ë¼(å¹³æ°)ê°€ íŒ¨ë°°í•˜ì í• ë¨¸ë‹ˆ í’ˆì— ì•ˆê²¨ íˆ¬ì‹ . í—¤ì´ì•ˆ ì‹œëŒ€ì˜ ì¢…ë§‰.' },
    // â”€â”€ ê°€ë§ˆì¿ ë¼~ë¬´ë¡œë§ˆì¹˜~ì „êµ­ (1185â€“1573) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    { name: '96ëŒ€ ê³ ë‹¤ì´ê³  ì²œí™©(å¾Œé†é†)', start: 1318, end: 1339, summary: 'ê²ë¬´ ì‹ ì •ìœ¼ë¡œ ë¬´ì‹  ì •ê¶Œ íƒ€íŒŒë¥¼ ì‹œë„í–ˆìœ¼ë‚˜ ì‹¤íŒ¨. ìš”ì‹œë…¸ë¡œ í”¼ì‹ í•˜ì—¬ ë‚¨ì¡°ë¥¼ ì„¸ìš°ê³  ë‚¨ë¶ì¡° ì‹œëŒ€ë¥¼ ì—¼.' },
    { name: '100ëŒ€ ê³ ì½”ë§ˆì“° ì²œí™©(å¾Œå°æ¾)', start: 1382, end: 1412, summary: 'ì•„ì‹œì¹´ê°€ ë§‰ë¶€ì˜ ì¤‘ì¬ë¡œ ë¶„ì—´ë˜ì—ˆë˜ ë‚¨ë¶ì¡°ë¥¼ í†µí•©(1392). ë¶ì¡° ê³„í†µìœ¼ë¡œ ì¼ë³¸ ì™•ì‹¤ì´ í†µì¼ë¨.' },
    { name: '105ëŒ€ ê³ ë‚˜ë¼ ì²œí™©(å¾Œå¥ˆè‰¯)', start: 1526, end: 1557, summary: 'ì „êµ­ ì‹œëŒ€ì˜ í˜¼ë€ ì†ì—ì„œ ì™•ì‹¤ì˜ ê¶í•í•¨ì´ ê·¹ì— ë‹¬í•¨. ì¦‰ìœ„ì‹ ë¹„ìš©ì¡°ì°¨ ë§ˆë ¨í•˜ì§€ ëª»í•´ 10ë…„ì„ ê¸°ë‹¤ë¦¼.' },
    // â”€â”€ ì—ë„ ì‹œëŒ€ (1603â€“1867) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    { name: '108ëŒ€ ê³ ë¯¸ì¦ˆë…¸ì˜¤ ì²œí™©(å¾Œæ°´å°¾)', start: 1611, end: 1629, summary: 'ë„ì¿ ê°€ì™€ ë§‰ë¶€ì˜ ê°„ì„­(ê¸ˆì¤‘ë³‘ê³µê°€ì œë²•ë„)ì— ì €í•­í•˜ë©° ì–‘ìœ„. ë§‰ë¶€ì™€ ì™•ì‹¤ì˜ ê¸´ì¥ ê´€ê³„ë¥¼ ìƒì§•.' },
    { name: '119ëŒ€ ê³ ì¹´ì¿  ì²œí™©(å…‰æ ¼)',       start: 1779, end: 1817, summary: 'í˜„ëŒ€ ì¼ë³¸ ì™•ì‹¤(ë¯¸ì¹´ë„)ì˜ ì§ê³„ ì¡°ìƒ. ì™•ì‹¤ì˜ ê¶Œìœ„ë¥¼ íšŒë³µí•˜ë ¤ ë…¸ë ¥í•œ ì¤‘í¥ êµ°ì£¼.' },
    { name: '121ëŒ€ ê³ ë©”ì´ ì²œí™©(çµ±ä»)',        start: 1846, end: 1867, summary: 'ì„œêµ¬ ì—´ê°•ì˜ ê°œí•­ ì••ë ¥ê³¼ ë§‰ë¶€ ì²´ì œì˜ ë¶•ê´´ ì†ì—ì„œ ì‚¬ë§. ì–‘ì´(æ”˜å¤·)ë¥¼ ì§€ì§€í–ˆìœ¼ë‚˜ ë©”ì´ì§€ ìœ ì‹ ì„ ëª©ë„í•˜ì§€ ëª»í•¨.' },
    // â”€â”€ ê·¼í˜„ëŒ€: ë©”ì´ì§€ ì´í›„ (1867â€“í˜„ì¬) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    { name: '122ëŒ€ ë©”ì´ì§€ ì²œí™©(æ˜æ²»)',        start: 1867, end: 1912, summary: 'ë©”ì´ì§€ ìœ ì‹ . ìˆ˜ë„ë¥¼ ë„ì¿„ë¡œ ì´ì „í•˜ê³  ê·¼ëŒ€ êµ­ê°€ ì²´ì œë¥¼ í™•ë¦½. ì²­ì¼Â·ëŸ¬ì¼ ì „ìŸ ìŠ¹ë¦¬.' },
    { name: '123ëŒ€ ë‹¤ì´ì‡¼ ì²œí™©(å¤§æ­£)',        start: 1912, end: 1926, summary: 'ë‹¤ì´ì‡¼ ë°ëª¨í¬ë¼ì‹œ. ì •ë‹¹ ì •ì¹˜ì™€ ë¯¼ì£¼ì£¼ì˜ ìš´ë™ì´ í™œë°œíˆ ì „ê°œëœ ì‹œê¸°.' },
    { name: '124ëŒ€ ì‡¼ì™€ ì²œí™©(æ˜­å’Œ)',          start: 1926, end: 1989, summary: '2ì°¨ ì„¸ê³„ëŒ€ì „ ë°œë°œ ë° íŒ¨ì „. ì „í›„ í‰í™” í—Œë²•(1946) ë„ì…. ì¬ì„ 63ë…„ì˜ ìµœì¥ê¸° ê·¼í˜„ëŒ€ ì²œí™©.' },
    { name: '125ëŒ€ ì•„í‚¤íˆí†  ìƒì™•(å¹³æˆ)',      start: 1989, end: 2019, summary: 'í—¤ì´ì„¸ì´(å¹³æˆ). 2001ë…„ "ë°±ì œ ë¬´ë ¹ì™•ì˜ í˜ˆí†µì„ ì´ì–´ë°›ì•˜ë‹¤"ê³  ê³µì‹ ì–¸ê¸‰. 2019ë…„ ìƒì „ ì–‘ìœ„.' },
    { name: '126ëŒ€ ë‚˜ë£¨íˆí†  ì²œí™©(ä»¤å’Œ)',      start: 2019, end: null,  summary: 'ë ˆì´ì™€(ä»¤å’Œ). í˜„ì¬ì˜ ì¼ë³¸ ì²œí™©.' },
];

async function main() {
    const client = new MongoClient(MONGO_URI);
    await client.connect();
    const db = client.db(DB_NAME);
    const kingsCol = db.collection('kings');

    const existingDoc = await kingsCol.findOne({ country_id: COUNTRY_ID });
    const normalize = str => str.replace(/[\s\(\)\ï¼ˆ\ï¼‰\/\\&]/g, '');
    const existingNames = existingDoc ? existingDoc.kings.map(k => normalize(k.name)) : [];

    const toInsert = NEW_KINGS
        .filter(k => !existingNames.includes(normalize(k.name)))
        .map(k => ({
            _id: new ObjectId(),
            name: k.name,
            start: k.start,
            start_month: 1,
            end: k.end,
            end_month: k.end != null ? 12 : null,
            summary: k.summary,
        }));

    const skipped = NEW_KINGS.length - toInsert.length;
    if (skipped > 0) {
        const skippedNames = NEW_KINGS.filter(k => existingNames.includes(normalize(k.name))).map(k => k.name);
        console.log(`  â­  ì¤‘ë³µ ìŠ¤í‚µ: ${skippedNames.join(', ')}`);
    }

    if (toInsert.length === 0) {
        console.log('âœ… ì¶”ê°€í•  ìƒˆ ì²œí™© ì—†ìŒ (ëª¨ë‘ ì¤‘ë³µ)');
    } else {
        await kingsCol.updateOne(
            { country_id: COUNTRY_ID },
            { $push: { kings: { $each: toInsert } } },
            { upsert: true }
        );
        console.log(`âœ… [ì¼ë³¸(æ—¥æœ¬)] ${toInsert.length}ëª… ì‚½ì…:`);
        toInsert.forEach(k => console.log(`   - ${k.name} (${k.start} ~ ${k.end ?? 'í˜„ì¬'})`));
    }

    console.log(`\nğŸ‰ ì™„ë£Œ: ${toInsert.length}ëª… ì‚½ì…, ${skipped}ëª… ìŠ¤í‚µ`);
    await client.close();
}

main().catch(err => {
    console.error('âŒ ì˜¤ë¥˜:', err);
    process.exit(1);
});
