/**
 * ê³ ë ¤(é«˜éº—) ì™• í•œì¤„í‰(summary) ì—…ë°ì´íŠ¸ ìŠ¤í¬ë¦½íŠ¸
 * ê¸°ì¡´ 34ëª…ì˜ ì™•ì— summary ì¶”ê°€ (ì´ë¦„ ë§¤ì¹­ ê¸°ë°˜)
 * ì‹¤í–‰: node scripts/update_kings_goryeo_summary.js
 */

const { MongoClient, ObjectId } = require('mongodb');

const MONGO_URI = process.env.MONGO_URI || 'mongodb://localhost:27017';
const DB_NAME = 'realhistory';

const COUNTRY_ID = new ObjectId('68dc7f9ade5169a850293fc0'); // ê³ ë ¤(é«˜éº—)

// ì´ë¦„ í‚¤ â†’ summary ë§¤í•‘
const SUMMARY_MAP = {
    'íƒœì¡°':   'ëŒ€ë¥™ ê³ ë ¤ ê±´êµ­. ì‚¼í•œ í†µí•© ë° ë¶ì§„ ì •ì±…(ìš”ë™ ìˆ˜ë³µ)ìœ¼ë¡œ ëŒ€ë¥™ ë™ë°©ì˜ íŒ¨ê¶Œì„ ì¬í™•ë¦½.',
    'í˜œì¢…':   'ëŒ€ë¥™ ë™ë¶€ í•´ìƒ ì„¸ë ¥ê³¼ì˜ ê²°ì†ì„ ë‹¤ì§€ë©° ì™•ìœ„ ê³„ìŠ¹ ë¶„ìŸì„ ê·¹ë³µ.',
    'ì •ì¢…':   'ì„œê²½(ëŒ€ë™ ì¸ê·¼)ì„ ì¤‘ì‹œí•˜ê³  ë¶ë°© ë°©ì–´ë¥¼ ê°•í™”í•˜ë©° ìš”ë™ íšŒë³µì˜ ê¸°ë°˜ì„ ë‹¦ìŒ.',
    'ê´‘ì¢…':   'ì¹­ì œê±´ì›(ê´‘ë•Â·ì¤€í’). ê³¼ê±°ì œ ì‹¤ì‹œ ë° ë…¸ë¹„ì•ˆê²€ë²•ìœ¼ë¡œ í™©ì œê¶Œ ì¤‘ì•™ì§‘ê¶Œí™”.',
    'ê²½ì¢…':   'ì „ì‹œê³¼ ì œë„ë¡œ ëŒ€ë¥™ ê°•ì—­ì˜ í† ì§€ ì§€ë°°ê¶Œì„ í™•ë¦½í•˜ê³  ê·€ì¡± ê²½ì œ ì²´ê³„ë¥¼ ì •ë¹„.',
    'ì„±ì¢…':   'ìœ êµì  í†µì¹˜ ì²´ì œ ì •ë¹„ ë° 12ëª© ì„¤ì¹˜. ê±°ë€(ìš”)ì˜ 1ì°¨ ì¹¨ì…ì„ ì„œí¬ì˜ ë‹´íŒìœ¼ë¡œ ê²©í‡´.',
    'ëª©ì¢…':   'ê°•ì¡°ì˜ ì •ë³€ìœ¼ë¡œ íìœ„. ì™¸ì²™ê³¼ ì™•ê¶Œì˜ ê°ˆë“±ì´ í‘œë©´í™”ëœ ì‹œê¸°.',
    'í˜„ì¢…':   'ê³ ë ¤ì˜ ì¤‘í¥. ê±°ë€ì˜ ëŒ€ì¹¨ê³µ(2Â·3ì°¨)ì„ ë¬¼ë¦¬ì¹˜ê³  ë™ë°©ì˜ ë§¹ì£¼ë¡œ ë“±ê·¹.',
    'ë•ì¢…':   'ì²œë¦¬ì¥ì„± ì¶•ì¡°(ëŒ€ë¥™ ë¶ë°© ê²½ê³„ì„  í™•ì •). ê±°ë€ê³¼ì˜ ê¸´ì¥ ê´€ê³„ë¥¼ ê´€ë¦¬.',
    'ì •ì¢… (é–å®—)': 'ê±°ë€Â·ì†¡ê³¼ì˜ ì„¸ë ¥ ê· í˜•ì„ ìœ ì§€í•˜ë©° ëŒ€ì™¸ ì•ˆì •ê¸°ë¥¼ êµ¬ê°€.',
    'ë¬¸ì¢…':   'ê³ ë ¤ì˜ í™©ê¸ˆê¸°. ë™ë°©ì˜ ì²œìë¡œ ë¶ˆë¦¬ë©° ë¬¸í™”ì™€ í•™ë¬¸ì´ í¬ê²Œ ìœµì„±.',
    'ìˆœì¢…':   'ë¬¸ì¢…ì˜ ì¥ë‚¨ìœ¼ë¡œ ì¦‰ìœ„í–ˆìœ¼ë‚˜ 3ê°œì›” ë§Œì— ìŠ¹í•˜.',
    'ì„ ì¢…':   'ì†¡Â·ìš”Â·ì¼ë³¸Â·ëŒ€ë¦¬êµ­ê³¼ì˜ êµ­ì œ ë¬´ì—­ì„ í™œì„±í™”í•˜ë©° ê°œë°©ì  ì™¸êµë¥¼ ì „ê°œ.',
    'í—Œì¢…':   'ì–´ë¦° ë‚˜ì´ì— ì¦‰ìœ„í–ˆìœ¼ë‚˜ ìˆ™ì¢…ì— ì˜í•´ ì„ ìœ„ë¨.',
    'ìˆ™ì¢…':   'í™”í ì£¼ì¡°(í•´ë™í†µë³´) ë° ë‚¨ê²½(ë‚œì§•) ì²œë„ ì‹œë„. ë³„ë¬´ë°˜ ì°½ì„¤ë¡œ êµ°ì‚¬ë ¥ ê°•í™”.',
    'ì˜ˆì¢…':   'ë™ë¶ 9ì„± ê°œì²™. ì—¬ì§„ ì •ë²Œë¡œ ì œêµ­ ìœ„ìƒì„ ê°•í™”í•˜ê³  êµ­ì œ ê°ê°ì„ ë„“í˜.',
    'ì¸ì¢…':   'ì´ìê²¸ì˜ ë‚œ, ë¬˜ì²­ì˜ ì„œê²½ ì²œë„ ìš´ë™. ã€Šì‚¼êµ­ì‚¬ê¸°ã€‹ í¸ì°¬ìœ¼ë¡œ ì—­ì‚¬ ì •í†µì„± í™•ë¦½.',
    'ì˜ì¢…':   'ë¬´ì‹ ì •ë³€(1170)ìœ¼ë¡œ íìœ„. ë¬¸ì‹  ìš°ëŒ€ì— ë°˜ë°œí•œ ë¬´ì‹ ë“¤ì˜ ê¶Œë ¥ ì¥ì•… ì‹œì‘.',
    'ëª…ì¢…':   'ë¬´ì‹ ë“¤ì´ ì‹¤ê¶Œì„ ì¥ê³  ì™•ì€ ìƒì§•ì ìœ¼ë¡œ ë‚¨ìŒ. ìµœì”¨ ë¬´ì‹  ì •ê¶Œ ì„±ë¦½ì˜ ì „ì•¼.',
    'ì‹ ì¢…':   'ìµœì¶©í—Œì˜ ì§‘ê¶Œ ì•„ë˜ ëª…ëª©ìƒ ì™•ê¶Œ ìœ ì§€. ë§Œì ì˜ ë‚œ ë“± í•˜ì¸µë¯¼ ì €í•­ì´ ë°œìƒ.',
    'í¬ì¢…':   'ìµœì¶©í—Œì„ ì œê±°í•˜ë ¤ í–ˆìœ¼ë‚˜ ì‹¤íŒ¨í•˜ê³  íìœ„ë¨.',
    'ê°•ì¢…':   'ë¬´ì‹  ì •ê¶Œì˜ êµì²´ê¸°. ì§§ì€ ì¬ìœ„ ì¤‘ ê¶Œë ¥ ì¤‘ì‹¬ì´ ìµœìš°ë¡œ ì´ë™.',
    'ê³ ì¢…':   'ëª½ê³¨ê³¼ì˜ 30ë…„ ì „ìŸ. ê°•í™”ë„ë¡œ ì²œë„í•˜ì—¬ í•­ì „. íŒ”ë§ŒëŒ€ì¥ê²½ ì œì‘ìœ¼ë¡œ í˜¸êµ­ ì˜ì§€ í‘œëª….',
    'ì›ì¢…':   'ëª½ê³¨ê³¼ ê°•í™”ë¥¼ ë§ºê³  ì›ë‚˜ë¼ ë¶€ë§ˆêµ­ ì²´ì œì— ì§„ì…. ì‚¼ë³„ì´ˆì˜ ëŒ€ëª½ í•­ìŸì´ ë°œìƒ.',
    'ì¶©ë ¬ì™•': 'ì›ë‚˜ë¼ ê°„ì„­ê¸°ì˜ ì‹œì‘. ì¿ ë¹Œë¼ì´ ì¹¸ì˜ ë”¸ê³¼ í˜¼ì¸í•˜ë©° ìœ ë¼ì‹œì•„ ë„¤íŠ¸ì›Œí¬ì™€ ì—°ê²°.',
    'ì¶©ì„ ì™•': 'ì›ë‚˜ë¼ ë§Œê¶Œë‹¹ ì„¤ì¹˜. ì´ì œí˜„ ë“± í•™ìë“¤ê³¼ ë™ì„œ í•™ë¬¸ êµë¥˜ë¥¼ ì´‰ì§„.',
    'ì¶©ìˆ™ì™•': 'ì›ë‚˜ë¼ì˜ ê°„ì„­ê³¼ ê¶Œë¬¸ì„¸ì¡±ì˜ ë°œí˜¸ ì†ì—ì„œ ì™•ê¶Œ íšŒë³µì„ ëª¨ìƒ‰.',
    'ì¶©í˜œì™•': 'í­ì •ìœ¼ë¡œ ì›ë‚˜ë¼ì— ì˜í•´ ë‘ ì°¨ë¡€ íìœ„ë¨. ì™•ê¶Œì˜ ê·¹ë„ ì•½í™”ë¥¼ ìƒì§•.',
    'ì¶©ëª©ì™•': 'ì–´ë¦° ë‚˜ì´ì— ì¦‰ìœ„. ì •ì¹˜ë„ê°ì„ í†µí•´ ê°œí˜ì„ ì‹œë„í–ˆìœ¼ë‚˜ ë‹¨ëª….',
    'ì¶©ì •ì™•': 'ì›ë‚˜ë¼ ê°„ì„­ê¸° ë§ˆì§€ë§‰ ì™•. ê³µë¯¼ì™•ì— ì˜í•´ íìœ„ë¨.',
    'ê³µë¯¼ì™•': 'ë°˜ì› ìì£¼ ì •ì±…. ìŒì„±ì´ê´€ë¶€ íƒˆí™˜ ë° ìš”ë™ ì •ë²Œ ì‹œë„. ì‹ ëˆ ê°œí˜ìœ¼ë¡œ ì™•ê¶Œ ê°•í™” ë„ëª¨.',
    'ìš°ì™•':   'ì´ì„±ê³„ì˜ ìœ„í™”ë„ íšŒêµ°(1388)ìœ¼ë¡œ íìœ„. ê³ ë ¤ ì™•ì¡° ë§ê¸°ì˜ í˜¼ë€ì„ ìƒì§•.',
    'ì°½ì™•':   'ì´ì„±ê³„ ì¼íŒŒì— ì˜í•´ 1ë…„ ë§Œì— íìœ„. ì™•ì¡° êµì²´ì˜ ì§ì „ ë‹¨ê³„.',
    'ê³µì–‘ì™•': 'ê³ ë ¤ì˜ ë§ˆì§€ë§‰ ì™•. 1392ë…„ ì´ì„±ê³„ì— ì˜í•´ íìœ„ë˜ë©° 918ë…„ì— ì‹œì‘ëœ ê³ ë ¤ ì™•ì¡° ì¢…ê²°.',
};

function normalize(str) {
    return str.replace(/[\s\(\)\ï¼ˆ\ï¼‰\/\\&]/g, '');
}

// ì´ë¦„ì—ì„œ ë¬˜í˜¸ë§Œ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜ (ì˜ˆ: "íƒœì¡° (å¤ªç¥–) / ì™•ê±´" â†’ "íƒœì¡°")
function extractTitle(name) {
    const match = name.match(/^([ê°€-í£]+)/);
    return match ? match[1] : normalize(name);
}

async function main() {
    const client = new MongoClient(MONGO_URI);
    await client.connect();
    const db = client.db(DB_NAME);
    const kingsCol = db.collection('kings');

    const doc = await kingsCol.findOne({ country_id: COUNTRY_ID });
    if (!doc) {
        console.error('âŒ ê³ ë ¤ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        await client.close();
        return;
    }

    let updated = 0;
    let skipped = 0;

    for (const king of doc.kings) {
        const title = extractTitle(king.name);
        // ì •ì¢…(å®šå®—)ê³¼ ì •ì¢…(é–å®—) êµ¬ë¶„
        let summary;
        if (king.name.includes('é–å®—')) {
            summary = SUMMARY_MAP['ì •ì¢… (é–å®—)'];
        } else {
            summary = SUMMARY_MAP[title];
        }

        if (!summary) {
            console.log(`  âš ï¸  ë§¤í•‘ ì—†ìŒ: ${king.name}`);
            skipped++;
            continue;
        }

        await kingsCol.updateOne(
            { country_id: COUNTRY_ID, 'kings._id': king._id },
            { $set: { 'kings.$.summary': summary } }
        );
        console.log(`  âœ… ì—…ë°ì´íŠ¸: ${king.name}`);
        updated++;
    }

    console.log(`\nğŸ‰ ì™„ë£Œ: ${updated}ëª… ì—…ë°ì´íŠ¸, ${skipped}ëª… ìŠ¤í‚µ`);
    await client.close();
}

main().catch(err => {
    console.error('âŒ ì˜¤ë¥˜:', err);
    process.exit(1);
});
