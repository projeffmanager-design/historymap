/**
 * æ˜¥ç§‹äº”è¦‡ / æˆ°åœ‹ä¸ƒé›„ ì™• ë°ì´í„° ë²Œí¬ ì‚½ì… ìŠ¤í¬ë¦½íŠ¸
 * ì‹¤í–‰: node scripts/bulk_insert_kings_chunqiu.js
 */

const { MongoClient, ObjectId } = require('mongodb');

const MONGO_URI = process.env.MONGO_URI || 'mongodb://localhost:27017';
const DB_NAME = 'realhistory';

// êµ­ê°€ ID ë§¤í•‘ (countries ì»¬ë ‰ì…˜ì—ì„œ í™•ì¸ëœ ê°’)
const COUNTRY_IDS = {
    'åˆ_ì´ˆ': '690c246b8817969a0eb6940c',   // æ˜¥ç§‹äº”è¦‡ / æˆ°åœ‹ä¸ƒé›„ - ì´ˆ(æ¥š)
    'é½Š_ì œ': '690c31608817969a0eb69411',   // æ˜¥ç§‹äº”è¦‡ / æˆ°åœ‹ä¸ƒé›„ - ì œ(é½Š)
    'è¶Š_ì›”': '690df451c897e0a5795f8ac7',   // æ˜¥ç§‹äº”è¦‡ - ì›”(è¶Š)
    'íŒŒë¥´í‹°ì•„_ì•ˆì‹êµ­': '694d3d9b07f1d71fd5845414', // íŒŒë¥´í‹°ì•„(Parthia, ì•ˆì‹êµ­)
    'ç‡•_ì—°': '68e7c1d5f87e7a2d46a7c5a5',   // æˆ°åœ‹ä¸ƒé›„ - ì—°(ç‡•)
    'è¶™_ì¡°': '690c2f4d8817969a0eb6940e',   // æˆ°åœ‹ä¸ƒé›„ - ì¡°(è¶™) ä¸‰æ™‰
    'é­_ìœ„': '690c22f78817969a0eb6940a',   // æˆ°åœ‹ä¸ƒé›„ - ìœ„(é­) ä¸‰æ™‰
    'éŸ“_í•œ': '690c214f8817969a0eb69407',   // æˆ°åœ‹ä¸ƒé›„ - í•œ(éŸ“) ä¸‰æ™‰
    'ç§¦_ì§„': '68dc7f9ade5169a850293fe7',   // æˆ°åœ‹ä¸ƒé›„ - ì§„(ç§¦)
};

// ì‚½ì…í•  ì™• ë°ì´í„° (êµ­ê°€ë³„ ê·¸ë£¹)
const KINGS_DATA = [
    // â”€â”€ ì´ˆ(æ¥š) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        countryKey: 'åˆ_ì´ˆ',
        kings: [
            { name: 'ë„ì™•(æ‚¼ç‹)',   start: -401, end: -381, summary: 'ì˜¤ê¸°ë¥¼ ë“±ìš©í•˜ì—¬ ì´ˆë‚˜ë¼ì˜ êµ­ë ¥ì„ ì „êµ­ì‹œëŒ€ ìµœê°•ê¸‰ìœ¼ë¡œ ì˜¬ë¦¼.' },
            { name: 'ìœ„ì™•(å¨ç‹)',   start: -339, end: -329, summary: 'ì œë‚˜ë¼ë¥¼ ê²©íŒŒí•˜ê³  ì„œêµ­ ìœ ë¯¼ë“¤ì´ ì‚´ë˜ ê°•ë‚¨ ë•…ì„ ì™„ì „íˆ ì¥ì•….' },
            { name: 'ì°½í‰êµ°',       start: -224, end: -223, summary: 'ì´ˆë‚˜ë¼ì˜ ë§ˆì§€ë§‰ ì™•. ì§„ë‚˜ë¼ì— ëê¹Œì§€ ì €í•­í•˜ë‹¤ ì „ì‚¬í•¨.' },
        ]
    },
    // â”€â”€ ì œ(é½Š) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        countryKey: 'é½Š_ì œ',
        kings: [
            { name: 'í™˜ê³µ(æ¡“å…¬)', start: -685, end: -643, summary: 'ê´€ì¤‘ì„ ë“±ìš©í•˜ì—¬ ì¶˜ì¶”ì‹œëŒ€ ì²« ë²ˆì§¸ íŒ¨ìê°€ ë¨.' },
            { name: 'ìœ„ì™•(å¨ç‹)', start: -356, end: -320, summary: 'ì‚°ë™ë°˜ë„ì˜ ê°•ìë¡œ êµ°ë¦¼. ì§í•˜í•™ê¶ì„ í†µí•´ ë™ì´ ë¬¸í™”ë¥¼ ë¶€í¥.' },
            { name: 'ì™•ê±´(ç‹å»º)', start: -264, end: -221, summary: 'ì œë‚˜ë¼ì˜ ë§ˆì§€ë§‰ ì™•. ì§„ë‚˜ë¼ì— í•­ë³µí•˜ë©° ì‚°ë™ ê°•ì—­ ìƒì‹¤.' },
        ]
    },
    // â”€â”€ ì›”(è¶Š) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        countryKey: 'è¶Š_ì›”',
        kings: [
            { name: 'ìœ¤ìƒ(å…å¸¸)', start: -510, end: -497, summary: 'ì›”ë‚˜ë¼ë¥¼ ë³¸ê²©ì ì¸ ê°•êµ­ìœ¼ë¡œ ì„±ì¥ì‹œí‚¤ë©° ì˜¤ë‚˜ë¼ì™€ íŒ¨ê¶Œì„ ë‹¤íˆ¬ê¸° ì‹œì‘í•¨.' },
            { name: 'êµ¬ì²œ(å‹¾è¸)', start: -496, end: -464, summary: 'ì™€ì‹ ìƒë‹´ì˜ ì£¼ì¸ê³µ. BC 473ë…„ ì˜¤ë‚˜ë¼ë¥¼ ë©¸ë§ì‹œí‚¤ê³  ì„œì£¼(å¾å·)ì—ì„œ ì œí›„ë“¤ì„ ì†Œì§‘í•´ íŒ¨ìê°€ ë¨.' },
            { name: 'ë¬´ê°•(ç„¡å½Š)', start: -342, end: -306, summary: 'ì›”ë‚˜ë¼ì˜ ë§ˆì§€ë§‰ íŒ¨ì. ì œë‚˜ë¼ì™€ ì´ˆë‚˜ë¼ë¥¼ ê³µê²©í–ˆìœ¼ë‚˜ ì´ˆë‚˜ë¼ ìœ„ì™•ì—ê²Œ íŒ¨í•˜ë©° êµ­ë ¥ì´ ê¸‰ê²©íˆ ì‡ í‡´í•¨.' },
        ]
    },
    // â”€â”€ ì—°(ç‡•) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        countryKey: 'ç‡•_ì—°',
        kings: [
            { name: 'ì†Œì™•(æ˜­ç‹)', start: -311, end: -279, summary: 'ê³ ì¡°ì„ (ëŒ€ë™ì‹œ)ê³¼ ëŒ€ë¦½. ì•…ì˜ë¥¼ í†µí•´ ì œë‚˜ë¼ë¥¼ ê¶¤ë©¸ì‹œí‚´.' },
            { name: 'ì™•í¬(ç‹å–œ)', start: -254, end: -222, summary: 'ì—°ë‚˜ë¼ì˜ ë§ˆì§€ë§‰ ì™•. ì§„ì‹œí™© ì•”ì‚´ ì‹œë„ í›„ ìš”ë™ìœ¼ë¡œ í”¼ì‹ í–ˆìœ¼ë‚˜ ë©¸ë§.' },
        ]
    },
    // â”€â”€ ì¡°(è¶™) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        countryKey: 'è¶™_ì¡°',
        kings: [
            { name: 'ë¬´ë ¹ì™•(æ­¦éˆç‹)', start: -325, end: -299, summary: 'í˜¸ë³µê¸°ì‚¬ ë„ì…. ëŒ€ë¥™ ë¶ë°©ì˜ êµ°ì‚¬ ê°•êµ­ìœ¼ë¡œ ë¶€ìƒ.' },
            { name: 'ì™•ì²œ(ç‹é·)',     start: -235, end: -228, summary: 'ì¡°ë‚˜ë¼ì˜ ë§ˆì§€ë§‰ ì™•. ì§„ë‚˜ë¼ ì¥ìˆ˜ ì™•ì „ì˜ ê³µê²©ìœ¼ë¡œ ë©¸ë§.' },
        ]
    },
    // â”€â”€ ìœ„(é­) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        countryKey: 'é­_ìœ„',
        kings: [
            { name: 'ë¬¸í›„(æ–‡ä¾¯)', start: -445, end: -396, summary: 'ì „êµ­ì‹œëŒ€ì˜ ì„œë§‰ì„ ì—´ë©° ì¤‘ì›ì˜ íŒ¨ê¶Œì„ ê°€ì¥ ë¨¼ì € ì¥ì•…í•¨.' },
            { name: 'ì™•ê°€(ç‹å‡)', start: -227, end: -225, summary: 'ìœ„ë‚˜ë¼ì˜ ë§ˆì§€ë§‰ ì™•. ì§„ë‚˜ë¼ê°€ í™©í•˜ ë¬¼ì„ ëŒì–´ë“¤ì—¬ ë„ìì„ ì¹¨ìˆ˜ì‹œí‚´.' },
        ]
    },
    // â”€â”€ í•œ(éŸ“) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        countryKey: 'éŸ“_í•œ',
        kings: [
            { name: 'ì†Œí›„(æ˜­ä¾¯)', start: -362, end: -333, summary: 'ì‹ ë¶ˆí•´ë¥¼ ë“±ìš©í•˜ì—¬ ë‚´ì¹˜ë¥¼ ë‹¤ì¡Œìœ¼ë‚˜ ì „êµ­ì¹ ì›… ì¤‘ ê°€ì¥ ì•½í–ˆìŒ.' },
            { name: 'ì™•ì•ˆ(ç‹å®‰)', start: -238, end: -230, summary: 'í•œë‚˜ë¼ì˜ ë§ˆì§€ë§‰ ì™•. ì „êµ­ì¹ ì›… ì¤‘ ê°€ì¥ ë¨¼ì € ì§„ë‚˜ë¼ì— ë³‘í•©ë¨.' },
        ]
    },
    // â”€â”€ ì§„(ç§¦) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        countryKey: 'ç§¦_ì§„',
        kings: [
            { name: 'íš¨ê³µ(å­å…¬)',     start: -361, end: -338, summary: 'ìƒì•™ì˜ ë³€ë²•ìœ¼ë¡œ êµ­ê°€ ì‹œìŠ¤í…œì„ ì™„ì „íˆ ê°œì¡°í•˜ì—¬ ê°•ëŒ€êµ­ì´ ë¨.' },
            { name: 'ì†Œì–‘ì™•(æ˜­è¥„ç‹)', start: -306, end: -251, summary: 'ì¥í‰ëŒ€ì „ ìŠ¹ë¦¬. ëŒ€ë¥™ í†µì¼ì˜ ì‹¤ì§ˆì  ì™„ì„±ì ì—­í• .' },
            { name: 'ì‹œí™©ì œ(æ”¿)',     start: -246, end: -210, summary: 'BC 221ë…„ ëŒ€ë¥™ í†µì¼. ë™ì´ê³„ êµ­ê°€ë“¤ì˜ ê°•ì—­ì„ êµ°í˜„ì œë¡œ í¡ìˆ˜.' },
        ]
    },
    // â”€â”€ íŒŒë¥´í‹°ì•„(ì•ˆì‹êµ­) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        countryKey: 'íŒŒë¥´í‹°ì•„_ì•ˆì‹êµ­',
        kings: [
            { name: 'ì•„ë¥´ì‚¬ì¼€ìŠ¤ 1ì„¸', start: -247, end: -217, summary: 'íŒŒë¥´í‹°ì•„ ê±´êµ­ì. íŒŒë¥´ë‹ˆ ë¶€ì¡±ì˜ ìˆ˜ì¥.' },
            { name: 'ì•„ë¥´ì‚¬ì¼€ìŠ¤ 2ì„¸', start: -217, end: -191, summary: 'ì…€ë ˆìš°ì½”ìŠ¤ì˜ ê³µê²©ì„ ë§‰ì•„ë‚´ë©° ìƒì¡´ ë„ëª¨.' },
            { name: 'í”„ë¦¬ì•„íŒŒí‹°ìš°ìŠ¤', start: -191, end: -176, summary: 'ì œêµ­ì˜ ì´ˆê¸° ì•ˆì •í™” ë‹¨ê³„.' },
            { name: 'í”„ë¼ì•„í…ŒìŠ¤ 1ì„¸', start: -176, end: -171, summary: 'ì—˜ë¶€ë¥´ì¦ˆ ì‚°ë§¥ ì¼ëŒ€ ì ë ¹, ì˜í†  í™•ì¥ ì‹œì‘.' },
            { name: 'ë¯¸íŠ¸ë¦¬ë‹¤í…ŒìŠ¤ 1ì„¸', start: -171, end: -132, summary: 'ì‹¤ì§ˆì  ì œêµ­ ê±´ì„¤ì. ë©”ì†Œí¬íƒ€ë¯¸ì•„ ì ë ¹.' },
            { name: 'í”„ë¼ì•„í…ŒìŠ¤ 2ì„¸', start: -132, end: -127, summary: 'ë™ë°©ì˜ ìœ ëª©ë¯¼(í† ì¹´ë¦¬/ëŒ€ì›”ì§€ ê´€ë ¨)ê³¼ êµì „ ì¤‘ ì „ì‚¬.' },
            { name: 'ì•„ë¥´íƒ€ë°”ëˆ„ìŠ¤ 1ì„¸', start: -127, end: -124, summary: 'ë™ë°© ì„¸ë ¥ê³¼ì˜ ì „ìŸ ì§€ì† ì¤‘ ì „ì‚¬.' },
            { name: 'ë¯¸íŠ¸ë¦¬ë‹¤í…ŒìŠ¤ 2ì„¸', start: -124, end: -91, summary: '\'ì™•ì¤‘ì™•\' ì¹­í˜¸ ì‚¬ìš©. í•œë‚˜ë¼(ëŒ€ë¥™ ë™ë¶€)ì™€ ìˆ˜êµ, ì‹¤í¬ë¡œë“œ ì¥ì•….' },
        ]
    },
];

async function main() {
    const client = new MongoClient(MONGO_URI);
    await client.connect();
    const db = client.db(DB_NAME);
    const kingsCol = db.collection('kings');

    let totalInserted = 0;
    let totalSkipped = 0;

    for (const group of KINGS_DATA) {
        const countryId = new ObjectId(COUNTRY_IDS[group.countryKey]);

        // ì´ë¯¸ í•´ë‹¹ êµ­ê°€ ë¬¸ì„œê°€ ìˆëŠ”ì§€ í™•ì¸
        const existingDoc = await kingsCol.findOne({ country_id: countryId });
        // ì´ë¦„ ë¹„êµ ì‹œ ê³µë°±Â·ê´„í˜¸Â·ìŠ¬ë˜ì‹œ ì œê±° í›„ í•µì‹¬ ë¶€ë¶„ë§Œ ë¹„êµ
        const normalize = str => str.replace(/[\s\(\)\ï¼ˆ\ï¼‰\/\\]/g, '').replace(/\s+/g, '');
        const existingNames = existingDoc
            ? existingDoc.kings.map(k => normalize(k.name))
            : [];

        const newKings = group.kings
            .filter(k => !existingNames.includes(normalize(k.name)))
            .map(k => ({
                _id: new ObjectId(),
                name: k.name,
                start: k.start,
                start_month: 1,
                end: k.end,
                end_month: 12,
                summary: k.summary,
            }));

        const skipped = group.kings.length - newKings.length;
        totalSkipped += skipped;

        if (skipped > 0) {
            const skippedNames = group.kings
                .filter(k => existingNames.includes(normalize(k.name)))
                .map(k => k.name);
            console.log(`  â­  [${group.countryKey}] ì¤‘ë³µ ìŠ¤í‚µ: ${skippedNames.join(', ')}`);
        }

        if (newKings.length === 0) {
            console.log(`  âœ… [${group.countryKey}] ì¶”ê°€í•  ìƒˆ ì™• ì—†ìŒ`);
            continue;
        }

        await kingsCol.updateOne(
            { country_id: countryId },
            { $push: { kings: { $each: newKings } } },
            { upsert: true }
        );

        console.log(`  âœ… [${group.countryKey}] ${newKings.length}ëª… ì‚½ì…: ${newKings.map(k => k.name).join(', ')}`);
        totalInserted += newKings.length;
    }

    console.log(`\nğŸ‰ ì™„ë£Œ: ì´ ${totalInserted}ëª… ì‚½ì…, ${totalSkipped}ëª… ìŠ¤í‚µ`);
    await client.close();
}

main().catch(err => {
    console.error('âŒ ì˜¤ë¥˜:', err);
    process.exit(1);
});
